---
title: 'Final Project Part 1: Exploratory Data Analysis'
author: "Nick Tedesco"
date: "2022-12-13"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Package and Data Loading

```{r packages, output = FALSE}

library(ggplot2)
library(tidyverse)
library(caret)
library(pROC)

```

```{r data}

data <- read.csv('/Users/nick/Documents/GSPH/INFSCI 2595/fall2022_finalproject.csv')

head(data)

```

```{r derived features}

data <- data %>% 
  mutate(
    x5 = 1 - (x1 + x2 + x3 + x4), 
    w = x2 / (x3 + x4), 
    z = (x1 + x2) / (x4 + x5), 
    t = v1 * v2, 
    y = boot::logit(output), 
    outcome = ifelse(output < 0.33, 'event', 'non_event'),
    outcome = factor(outcome, levels = c("event", "non_event"))
  )

head(data)

```

## Part 1: Exploration

### Summary Statistics

Let's start by calculating some summary statistics for each of our variables. 

```{r summary stats}

summary(data)

```

### Univariate Distributions

Now, let's visualize each of the univariate distributions in the dataset. 

```{r Histogram: x1}

ggplot(data = data,
       mapping = aes(x = x1)) + 
  geom_histogram(bins = 20)

```

```{r Histogram: x2}

ggplot(data = data,
       mapping = aes(x = x2)) + 
  geom_histogram(bins = 20)

```

```{r Histogram: x3}

ggplot(data = data,
       mapping = aes(x = x3)) + 
  geom_histogram(bins = 20)

```

```{r Histogram: x4}

ggplot(data = data,
       mapping = aes(x = x4)) + 
  geom_histogram(bins = 20)

```

```{r Histogram: x5}

ggplot(data = data,
       mapping = aes(x = x5)) + 
  geom_histogram(bins = 20)

```

```{r Histogram: v1}

ggplot(data = data,
       mapping = aes(x = v1)) + 
  geom_histogram(bins = 20)

```

```{r Histogram: v2}

ggplot(data = data,
       mapping = aes(x = v2)) + 
  geom_histogram(bins = 20)

```

```{r Histogram: v3}

ggplot(data = data,
       mapping = aes(x = v3)) + 
  geom_histogram(bins = 20)

```

```{r Histogram: v4}

ggplot(data = data,
       mapping = aes(x = v4)) + 
  geom_histogram(bins = 20)

```

```{r Histogram: v5}

ggplot(data = data,
       mapping = aes(x = v5)) + 
  geom_histogram(bins = 20)

```

```{r Bar Chart: M}

ggplot(data = data,
       mapping = aes(x = m)) + 
  geom_bar()

```

```{r Histogram: w}

ggplot(data = data,
       mapping = aes(x = w)) + 
  geom_histogram(bins = 20)

```

```{r Histogram: z}

ggplot(data = data,
       mapping = aes(x = z)) + 
  geom_histogram(bins = 20)

```

```{r Histogram: t}

ggplot(data = data,
       mapping = aes(x = t)) + 
  geom_histogram(bins = 20)

```

```{r Histogram: output}

ggplot(data = data,
       mapping = aes(x = output)) + 
  geom_histogram(bins = 20)

```

```{r Histogram: y}

ggplot(data = data,
       mapping = aes(x = y)) + 
  geom_histogram(bins = 20)

```

```{r Bar Chart: Outcome}

ggplot(data = data,
       mapping = aes(x = outcome)) + 
  geom_bar()

```

### Univariate Distributions Facetted by Categorical Input (M)

Now, let's visualize each of the univariate distributions again, by facetted by the categorical input (m).

```{r Histogram: x1 (Facetted by M)}

ggplot(data = data,
       mapping = aes(x = x1)) + 
  geom_histogram(bins = 20) + 
  facet_wrap(~m)

```

```{r Histogram: x2 (Facetted by M)}

ggplot(data = data,
       mapping = aes(x = x2)) + 
  geom_histogram(bins = 20) + 
  facet_wrap(~m)

```

```{r Histogram: x3 (Facetted by M)}

ggplot(data = data,
       mapping = aes(x = x3)) + 
  geom_histogram(bins = 20) + 
  facet_wrap(~m)

```

```{r Histogram: x4 (Facetted by M)}

ggplot(data = data,
       mapping = aes(x = x4)) + 
  geom_histogram(bins = 20) + 
  facet_wrap(~m)

```

```{r Histogram: x5 (Facetted by M)}

ggplot(data = data,
       mapping = aes(x = x5)) + 
  geom_histogram(bins = 20) + 
  facet_wrap(~m)

```

```{r Histogram: v1 (Facetted by M)}

ggplot(data = data,
       mapping = aes(x = v1)) + 
  geom_histogram(bins = 20) + 
  facet_wrap(~m)

```

```{r Histogram: v2 (Facetted by M)}

ggplot(data = data,
       mapping = aes(x = v2)) + 
  geom_histogram(bins = 20) + 
  facet_wrap(~m)

```

```{r Histogram: v3 (Facetted by M)}

ggplot(data = data,
       mapping = aes(x = v3)) + 
  geom_histogram(bins = 20) + 
  facet_wrap(~m)

```

```{r Histogram: v4 (Facetted by M)}

ggplot(data = data,
       mapping = aes(x = v4)) + 
  geom_histogram(bins = 20) + 
  facet_wrap(~m)

```

```{r Histogram: v5 (Facetted by M)}

ggplot(data = data,
       mapping = aes(x = v5)) + 
  geom_histogram(bins = 20) + 
  facet_wrap(~m)

```

```{r Histogram: w (Facetted by M)}

ggplot(data = data,
       mapping = aes(x = w)) + 
  geom_histogram(bins = 20) + 
  facet_wrap(~m)

```

```{r Histogram: z (Facetted by M)}

ggplot(data = data,
       mapping = aes(x = z)) + 
  geom_histogram(bins = 20) + 
  facet_wrap(~m)

```

```{r Histogram: t (Facetted by M)}

ggplot(data = data,
       mapping = aes(x = t)) + 
  geom_histogram(bins = 20) + 
  facet_wrap(~m)

```

```{r Histogram: output (Facetted by M)}

ggplot(data = data,
       mapping = aes(x = output)) + 
  geom_histogram(bins = 20) + 
  facet_wrap(~m)

```

```{r Histogram: y (Facetted by M)}

ggplot(data = data,
       mapping = aes(x = y)) + 
  geom_histogram(bins = 20) + 
  facet_wrap(~m)

```

```{r Bar Chart: Outcome (Facetted by M)}

ggplot(data = data,
       mapping = aes(x = outcome)) + 
  geom_bar() + 
  facet_wrap(~m)

```

For each of the input variables, their respective univariate distributions show no extreme change with different values of m. The output and logit-transformed output (y) both show similar distributions across the different values of m. The event:nonevent proportion for the outcome variable does not drastically change with m, but it does appear that m == D results in a more even distribution of event vs non-event, as compared to the rest of the values of m. Also, perhaps m == E results in a higher proportion of the non-event.

These findings suggest that the machine (m) may not greatly impact the output/outcome.

### Relationships Between Inputs

We can look at the relationships between inputs by making a correlation matrix for all inputs in the dataset. 

```{r corrplot of inputs}

cor_matrix <- cor((data %>% select(-c(m, output, y, outcome))))

corrplot::corrplot(cor_matrix, type = 'upper', method = 'square')

```

Some of the base / derived features are very correlated, as illustrated by the above correlation plot. This may be somewhat problematic when fitting certain types of regression models. We will look at some of these relationships more in-depth when visualizating the binary outcome with respect to 2D combinations of the inputs (see "Relationships Between Binary Outcome and Inputs / Derived Features" Chunk).

### Relationships Between Outputs and Inputs

Next, let's look at the relationships between the different outputs and inputs by making scatter plots for each combination of input and output/y. 

```{r Output vs Inputs and Derived Features}

data %>% pivot_longer(cols = c(x1, x2, x3, x4, x5, v1, v2, v3, v4, v5, w, z, t)) %>%
  ggplot(mapping = aes(x = value, y = output)) + 
  geom_point(alpha = 0.3) + 
  facet_wrap(~name, scales = 'free')
  
```

```{r y vs Inputs and Derived Features}

data %>% pivot_longer(cols = c(x1, x2, x3, x4, x5, v1, v2, v3, v4, v5, w, z, t)) %>%
  ggplot(mapping = aes(x = value, y = y)) + 
  geom_point(alpha = 0.3) + 
  facet_wrap(~name, scales = 'free')
  
```

We can see clear patterns between some of the inputs and the output/transformed output. More specifically, look at z vs y (quadratic?) and x1 vs y (wave-like? quadratic? polynomial?), and w (wave-like? polynomial?) - these appear to be the strongest relationships.

### Relationships Between Binary Outcome and Inputs

Finally, we can visualize the relationships between the binary outcome and the inputs by making 2D scatterplots for each combination of the inputs, and coloring the points by the value of the outcome (event/non-event).

```{r x1 vs Colored by Binary Outcome}

data %>% pivot_longer(cols = c(x2, x3, x4, x5, v1, v2, v3, v4, v5, w, z, t)) %>%
  ggplot(mapping = aes(x = x1, y = value)) + 
  geom_point(aes(color = as.factor(outcome), shape = as.factor(outcome)), size = 1) + 
  facet_wrap(~name, scales = 'free')
  
```

There seem to be a few important interactions between x1 and some of the other inputs... (ex: x1 vs w, z, x2, x3).

```{r x2 vs Inputs Colored by Binary Outcome}

data %>% pivot_longer(cols = c(x3, x4, x5, v1, v2, v3, v4, v5, w, z, t)) %>%
  ggplot(mapping = aes(x = x2, y = value)) + 
  geom_point(aes(color = as.factor(outcome), shape = as.factor(outcome)), size = 1) + 
  facet_wrap(~name, scales = 'free')
  
```

The interaction between x2 and w seems to show some patterns for the binary outcome variable...

```{r x3 vs Inputs Colored by Binary Outcome}

data %>% pivot_longer(cols = c(x4, x5, v1, v2, v3, v4, v5, w, z, t)) %>%
  ggplot(mapping = aes(x = x3, y = value)) + 
  geom_point(aes(color = as.factor(outcome), shape = as.factor(outcome)), size = 1) + 
  facet_wrap(~name, scales = 'free')
  
```

```{r x4 vs Inputs Colored by Binary Outcome}

data %>% pivot_longer(cols = c(x5, v1, v2, v3, v4, v5, w, z, t)) %>%
  ggplot(mapping = aes(x = x4, y = value)) + 
  geom_point(aes(color = as.factor(outcome), shape = as.factor(outcome)), size = 1) + 
  facet_wrap(~name, scales = 'free')
  
```

```{r x5 vs Inputs Colored by Binary Outcome}

data %>% pivot_longer(cols = c(v1, v2, v3, v4, v5, w, z, t)) %>%
  ggplot(mapping = aes(x = x5, y = value)) + 
  geom_point(aes(color = as.factor(outcome), shape = as.factor(outcome)), size = 1) + 
  facet_wrap(~name, scales = 'free')
  
```

```{r v1 vs Inputs Colored by Binary Outcome}

data %>% pivot_longer(cols = c(v2, v3, v4, v5, w, z, t)) %>%
  ggplot(mapping = aes(x = v1, y = value)) + 
  geom_point(aes(color = as.factor(outcome), shape = as.factor(outcome)), size = 1) + 
  facet_wrap(~name, scales = 'free')
  
```

```{r v2 vs Inputs Colored by Binary Outcome}

data %>% pivot_longer(cols = c(v3, v4, v5, w, z, t)) %>%
  ggplot(mapping = aes(x = v2, y = value)) + 
  geom_point(aes(color = as.factor(outcome), shape = as.factor(outcome)), size = 1) + 
  facet_wrap(~name, scales = 'free')
  
```

```{r v3 vs Inputs Colored by Binary Outcome}

data %>% pivot_longer(cols = c(v4, v5, w, z, t)) %>%
  ggplot(mapping = aes(x = v3, y = value)) + 
  geom_point(aes(color = as.factor(outcome), shape = as.factor(outcome)), size = 1) + 
  facet_wrap(~name, scales = 'free')
  
```

```{r v4 vs Inputs Colored by Binary Outcome}

data %>% pivot_longer(cols = c(v5, w, z, t)) %>%
  ggplot(mapping = aes(x = v4, y = value)) + 
  geom_point(aes(color = as.factor(outcome), shape = as.factor(outcome)), size = 1) + 
  facet_wrap(~name, scales = 'free')
  
```

```{r v5 vs Inputs Colored by Binary Outcome}

data %>% pivot_longer(cols = c(w, z, t)) %>%
  ggplot(mapping = aes(x = v5, y = value)) + 
  geom_point(aes(color = as.factor(outcome), shape = as.factor(outcome)), size = 1) + 
  facet_wrap(~name, scales = 'free')
  
```

```{r w vs Inputs Colored by Binary Outcome}

data %>% pivot_longer(cols = c(z, t)) %>%
  ggplot(mapping = aes(x = w, y = value)) + 
  geom_point(aes(color = as.factor(outcome), shape = as.factor(outcome)), size = 1) + 
  facet_wrap(~name, scales = 'free')
  
```

```{r z vs Inputs Colored by Binary Outcome}

data %>% pivot_longer(cols = c(t)) %>%
  ggplot(mapping = aes(x = z, y = value)) + 
  geom_point(aes(color = as.factor(outcome), shape = as.factor(outcome)), size = 1) + 
  facet_wrap(~name, scales = 'free')
  
```
